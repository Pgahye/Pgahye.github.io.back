---
layout : post
author : sm.woo
comments : true
title : "프로토타입 패턴"
date : "2017-12-20"

---

연구내용
======

프로토타입이란?
===========

**프로토타입(Prototype)은** 사전적인 의미로 대량 생산에 앞서 미리 제작해보는 **원형** 또는 **시제품으로**, 제작물의 모형이라 할 수 있다. 소프트웨어 개발에서는 정식 절차에 따라 완전한 소프트웨어를 만들기 전에 사용자의 요구를 받아 일단 모형을 만들고 이 모형을 사용자와 의사소통하는 도구로 활용한다.

일상 생활에서 볼 수 있는 **프로토타입은** 아파트 **모델하우스를** 예로 들 수 있다.
이 프로토타입인 모델하우스를 통해서 추후에 지어질 아파트에 대한 **정보를 얻을 수 있다.**

<br>

프로토타입 패턴
===========

프로토타입 패턴도 마찬가지로 **원형이 되는 인스턴스를 근본으로 해서 새로운 인스턴스를 만드는 것** 이라고 할 수 있다. Java 언어에서 복사하는 하는 것을 **'clone'** 이라고 하고 있다.

소프트 웨어 디자인 패턴에서 프로토타입 패턴은 생성할 객체들의 타입이 프로토타입인 인스턴스로부터 결정되도록 하며, 인스턴스는 새 객체를 만들기 위해 자신을 복제하게 된다.

>프로토타입 패턴은 새로운 객체는 일반적인 방법으로 객체를 생성하는 고유의 비용이 주어진 응용 프로그램 상황에 있어서 불가피하게 매우 클 때, 이 비용을 감내하지 않을 수 있게 해준다.

<Br>

#### 프로토타입이 필요한 경우
**new** 라는 자바 언어의 키워드를 사용하여 클래스 이름을 지정해서 인스턴스를 생성한다.
이처럼 new 연산자로 인스턴스를 만드는 경우에는 클래스 이름을 반드시 지정해야 한다.
그러나 클래스 이름을 지정하지 않고 인스턴스를 생성하는 경우도 있다.

##### 다음과 같은 경우에 인스턴스를 복사해서 새로운 인스턴스를 생성한다.

1. 종류가 너무 많아 한개의 클래스로 할 수 없는 경우
2. 클래스로 부터 인스턴스를 생성하기 어려운 경우
3. 프레임워크와 생성할 인스턴스를 분리하고 싶은 경우

**패턴을 구현하려면 우선 clone() 메소드를 선언하는 추상 베이스 클래스를 하나 만든다.** 다형적 생성자 기능이 필요한 클래스가 있다면, 그것을 앞에서 만든 클래스를 상속받게 한 후, clone() 메소드 내의 코드를 구현한다.

<br>

프로토타입 패턴에 사용되는 역할
===========
![flickr](https://farm5.staticflickr.com/4732/24348417007_df94666425_b.jpg)

### Prototype
prototype의 역할은 인스턴스를 복사해서 새로운 인스턴스를 만들기 위한 메소드를 결정하는 역할

### ConcretePrototype
ConcretePrototype의 역할은 인스턴스를 복사해서 새로운 인스턴스를 만드는 메소드를 실제로 구현하는 역할

### Client
Client의 역할은 인스턴스를 복사하는 메소드를 이용해서 새로운 인스턴스를 만드는 역할

<br>

### 예제


##### Product 인터페이스
```java
/*
 * Product.java
 *
 * version 1.0
 *
 * 2017-12-21
 *
 * Copyright 1996 - 2017 hibrain.net All rights reserved.
 */

package io.hibrain.tutorial.designpattern.prototype;

public interface Product extends Cloneable {
    public abstract void use(String s);
    public abstract Product createClone();
}
```
Product 인터페이스는 **java.lang.Cloneable** 인터페이스를 상속하고 있다.
이 인터페이스를 구현하고 있는 클래스의 인스턴스는 clone 메소드를 사용해서 자동적으로 복제를 진행할 수 있다.

use 메소드는 **사용** 하기 위한 메소드이고 무엇을 의미하는 지는 하위 클래스의 구현에 맞겨져 있다. createClone 메소드는 인스턴스를 복제하기 위한 것이다.

<br>

#### Manager 클래스
```java
/*
 * Manager.java
 *
 * version 1.0
 *
 * 2017-12-21
 *
 * Copyright 1996 - 2017 hibrain.net All rights reserved.
 */

package io.hibrain.tutorial.designpattern.prototype;

import java.util.Hashtable;

public class Manager {
    private Hashtable showcase = new Hashtable();
    public void register(String name, Product proto) {
        showcase.put(name, proto);
    }

    public Product create(String protoname){
        Product p = (Product) showcase.get(protoname);
        return p.createClone();
    }
}
```

Manager 클래스는 Product 인터페이스를 이용해서 인스턴스를 복제하는 클래스다.

**showcase** 필드는 인스턴스의 이름과 인스턴스의 대응관계를 Hashtable로 표현한 것이다.
register 메소드에서 제품의 이름과 Product 인터페이스가 제공되면 그 한 쌍을 showcase에 등록한다.

Product 인터페이스나 Manager 클래스의 소스에 MessageBox 클래스나 UnderlinePen 클래스의 이름이 전혀 등장하지 않는 점에 유의해야한다. **클래스의 이름이 등장하지 않는 것은 Product나 Manager와 관계없이 수정할 수 있다는 것을 의미하므로 대단히 중요한 핵심이다.**

<br>

#### MessageBox 클래스
```java
/*
 * MessageBox.java
 *
 * version 1.0
 *
 * 2017-12-21
 *
 * Copyright 1996 - 2017 hibrain.net All rights reserved.
 */

package io.hibrain.tutorial.designpattern.prototype;

public class MessageBox implements Product {
    private char decochar;
    public MessageBox(char decochar) {
        this.decochar = decochar;
    }

    public void use(String s) {
        int length = s.getBytes().length;
        for (int i = 0; i < length + 4; i++) {
            System.out.print(decochar);
        }
        System.out.println(" ");

        System.out.println(decochar + " " + s + " " + decochar);

        for (int i = 0; i < length + 4; i++) {
            System.out.print(decochar);
        }
        System.out.println(" ");
    }

    @Override
    public Product createClone() {
        Product p = null;
        try {
            p = (Product)clone();
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return p;
    }
}

```
MessageBox 클래스는 Product 인터페이스를 구현
decochar 필드는 decorate char 즉 문자열을 꾸며줄 장식 문자를 의미
use 메소스는 주어진 문자를 decochar로 둘러싼다.

createClone 메소드는 **자기 자신을 복제하는 메소드다.**
clone 메소드는 자바 언어 스팩에 규정되어 있는 것으로 자기 자신의 복제를 실행한다.
clone 메소드는 **자신의 클래스나 하위 클래스에서만 호출을 할 수 있기 때문에** 다른 클래스의
요철으로 복제하는 경우에 다른 메소드로 clone 메소드를 감싸줄 필요가 있다.

<br>

#### UnderlinePen 클래스
```java
/*
 * UnderlinePen.java
 *
 * version 1.0
 *
 * 2017-12-21
 *
 * Copyright 1996 - 2017 hibrain.net All rights reserved.
 */

package io.hibrain.tutorial.designpattern.prototype;

public class UnderlinePen implements Product {
    private char ulchar;
    public UnderlinePen(char ulchar) {
        this.ulchar = ulchar;
    }

    public void use(String s) {
        int length = s.getBytes().length;
        System.out.println("\"" + s + "\"");
        System.out.print(" ");
        for (int i = 0; i < length; i++) {
            System.out.print(ulchar);
        }
        System.out.println("");
    }

    public Product createClone() {
        Product p = null;
        try {
            p = (Product)clone();
        }catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return p;
    }
}

```

UnderlinePen 클래스는 MessageBox와 거의 같은 동작을 한다.
ulchar이라는 필드는 Underline char, 즉 문자열에 밑줄을 긋는 장식 문자 긋는데 사용된다.
use 메소드는 주어진 물자열을 큰따옴표로 묶으면서 문자열 부문에 밑줄을 긋는다.

<br>

#### Main 클래스
```java
/*
 * HNMain.java
 *
 * version 1.0
 *
 * 2017-12-21
 *
 * Copyright 1996 - 2017 hibrain.net All rights reserved.
 */

package io.hibrain.tutorial.designpattern.prototype;

public class HBNMain {
    public static void main(String[] args) {
        Manager manager = new Manager();
        UnderlinePen upen = new UnderlinePen('~');
        MessageBox mbox = new MessageBox('*');
        MessageBox sbox = new MessageBox('/');
        manager.register("strong message", upen);
        manager.register("warning box", mbox);
        manager.register("slash box", sbox);

        Product p1 = manager.create("strong message");
        p1.use("Hello, world");
        System.out.println();
        Product p2 = manager.create("warning box");
        p2.use("Hello, world");
        System.out.println();
        Product p3 = manager.create("slash box");
        p3.use("Hello, world");
    }
}

```

Main 클래스에서는 우선 Manager의 인스턴스를 만들고 Manager 인스턴스에
Underline 인스턴스와 MessageBox 인스턴스를 Hashtable에 등록(register)한다.

참고자료
======
Java 언어로 배우는 디자인 패턴, Yuki Hiroshi ,2001
